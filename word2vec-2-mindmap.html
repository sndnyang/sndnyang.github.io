<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="杨秀隆 sndnyang sndnyang.github.io" />
        <meta name="copyright" content="杨秀隆 sndnyang sndnyang.github.io" />

<link rel="stylesheet" href="http://bdimg.share.baidu.com/static/api/css/share_style1_24.css">

<meta name="keywords" content="nlp, word2vec, 翻译, " />

        <title>基于Word2Vec生成基本的思维导图  · 懒龙谷
</title>
        <!--<link href="http://cdn-images.mailchimp.com/embedcode/slim-081711.css" rel="stylesheet" type="text/css">-->
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="/theme/css/style.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/css/solarizedlight.css" media="screen">
        <link href="/theme/css/font-awesome.min.css" rel="stylesheet" />

        <link rel="shortcut icon" href="/theme/images/favicon.ico" type="image/x-icon" />
        <link rel="apple-touch-icon" href="/theme/images/apple-touch-icon.png" />
        <link rel="apple-touch-icon" sizes="57x57" href="/theme/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="/theme/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="/theme/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon" sizes="144x144" href="/theme/images/apple-touch-icon-144x144.png" />
        <link rel="icon" href="/theme/images/apple-touch-icon-144x144.png" />

        <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
        <script src="/theme/js/index.js" type="text/javascript"></script>
        <script type="text/javascript">
		$(document).ready(function() {
		    init_mathjax();
		    backToTop();
		});
      
    	</script>
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top" style="position:fixed;width:100%">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="/"><span class="site-name">懒龙谷</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li><a href="/index.html">Home</a></li>
                            <li><a href="/categories.html">Categories</a></li>
                            <li><a href="/tags.html">Tags</a></li>
                            <li><a href="/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page_header span10 offset2">
    <h1><a href="/word2vec-2-mindmap.html"> 基于Word2Vec生成基本的思维导图  </a></h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav style="position:fixed; left:10px;">
        <h4>Contents</h4>
        <div class="toc">
<ul>
<li><a href="#n">第一步： 从文章中找出前n项</a></li>
<li><a href="#_1">第二步： 选定根节点</a></li>
<li><a href="#_2">第三步： 生成导图</a></li>
<li><a href="#_3">示例输出</a></li>
<li><a href="#_4">其他</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">

            
<p>译自：</p>
<p><a href="https://codesachin.wordpress.com/2015/10/15/generating-rudimentary-mind-maps-from-word2vec-models/">原文链接</a>
(没有找过作者， 随手就翻译了)</p>
<p>思维导图这一工具因其长于组织大量任务、材料信息，在头脑风暴、 计划和问题解决等领域得到广泛使用、一致好评。</p>
<p>对思路的可视整理有助于整个思考的过程， 并且模拟了我们人类思考时获取脑中知识的方式。</p>
<p>现今有很多工具可以帮助我们画出思维导图， 但还没有一个能自行生成的， “生成”是指从文本（语音）内容中提成。</p>
<p>为了做到这一点， 我花了最长的时间（至今快8个月了）， 研究如何结合文本挖掘和图论做成一个框架来生成思维导图（给定一段文本）。</p>
<p>当然， 第一个问题就是， 任意一段文字都不会只有那么一种可行的思维导图。</p>
<p>只是， 如果你要构建自己的思维导图， 有这么一个自动工具， 可能会给你更多的思路和洞见， 特别是头脑风暴时， 或帮你查缺补漏。</p>
<p>那我们先来看看一个思维导图的样式——</p>
<p><img alt="1.jpg" src="https://codesachin.files.wordpress.com/2015/10/laws_mindmap.jpg?w=477&amp;h=261"/></p>
<p>两个关键点：</p>
<ul>
<li>思维导图并不简单地是一棵树， 不只是递归地将主题划分成子主题。 它本质上更像图， 连接项在语义上是相关的。</li>
<li>正如‘夜晚’可能会让你想到‘白天’， 思维导图中， 意义相反的两个概念之间也很可能存在连接。</li>
</ul>
<p>还有诸如使用图片强化概念等其他点。但这些并不是本文的主旨（我的设计师风格创造力糟透了）。 </p>
<p>有备无患 ， <a href="http://lifehacker.com/how-to-use-mind-maps-to-unleash-your-brains-creativity-1348869811">Heres</a> 这篇文章能帮助你熟悉构建和使用思维导图的过程。</p>
<p>在我上一篇博文 <a href="https://codesachin.wordpress.com/2015/10/09/generating-a-word2vec-model-from-a-block-of-text-using-gensim-python/">链接</a> 中， 我描述了一种从文本生成Word2Vec模型的方法（使用维基的文章作为示例）。</p>
<p>在这里， 我将描述我使用的从 Word2Vec模型生成基本思维导图的方法。</p>
<h2 id="n">第一步： 从文章中找出前n项</h2>
<p>（就像我上一篇博文所说， 我只使用stemmed unigrams（一个词干的n-gram), 你可以自行采用更高阶的ngrams, 想来会更棘手（准确来说， 是当你生成n-gram的算法有效时）</p>
<p>这里的 n 是指思维导图中的节点数， 在我多次尝试之后， 50是个比较好的数字， 太小则信息少， 太大则噪音多。 欢迎尝试其他数字。</p>
<p>我使用了本文 <a href="https://www.aaai.org/Papers/FLAIRS/2003/Flairs03-076.pdf">链接</a> 中写的 co-occurrence 方法， 列出文本的前 n 项词。 代码如下：</p>
<div class="highlight"><pre><span class="n">def</span> <span class="n">_get_param_matrices</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">,</span> <span class="n">sentence_terms</span><span class="p">)</span><span class="o">:</span>
    <span class="s">"""</span>
    <span class="n">Returns</span>
    <span class="o">=======</span>
    <span class="mf">1.</span> <span class="n">Top</span> <span class="mi">300</span><span class="p">(</span><span class="n">or</span> <span class="n">lesser</span><span class="p">,</span> <span class="k">if</span> <span class="n">vocab</span> <span class="n">is</span> <span class="kt">short</span><span class="p">)</span> <span class="n">most</span> <span class="n">frequent</span> <span class="n">terms</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
    <span class="mf">2.</span> <span class="n">co</span><span class="o">-</span><span class="n">occurence</span> <span class="n">matrix</span> <span class="n">wrt</span> <span class="n">the</span> <span class="n">most</span> <span class="n">frequent</span> <span class="n">terms</span><span class="p">(</span><span class="n">dict</span><span class="p">)</span>
    <span class="mf">3.</span> <span class="n">Dict</span> <span class="n">containing</span> <span class="n">Pg</span> <span class="n">of</span> <span class="n">most</span><span class="o">-</span><span class="n">frequent</span> <span class="n">terms</span><span class="p">(</span><span class="n">dict</span><span class="p">)</span>
    <span class="mf">4.</span> <span class="n">nw</span><span class="p">(</span><span class="n">no</span> <span class="n">of</span> <span class="n">terms</span> <span class="n">affected</span><span class="p">)</span> <span class="n">of</span> <span class="n">each</span> <span class="n">term</span><span class="p">(</span><span class="n">dict</span><span class="p">)</span>
    <span class="s">"""</span>

    <span class="err">#</span><span class="n">Figure</span> <span class="n">out</span> <span class="n">top</span> <span class="n">n</span> <span class="n">terms</span> <span class="n">with</span> <span class="n">respect</span> <span class="n">to</span> <span class="n">mere</span> <span class="n">occurences</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="n">len</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">))</span>
    <span class="n">topterms</span> <span class="o">=</span> <span class="n">list</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">topterms</span><span class="p">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="n">lambda</span> <span class="n">x</span><span class="o">:</span> <span class="n">vocabulary</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">reverse</span> <span class="o">=</span> <span class="n">True</span><span class="p">)</span>
    <span class="n">topterms</span> <span class="o">=</span> <span class="n">topterms</span><span class="p">[</span><span class="o">:</span><span class="n">n</span><span class="p">]</span>

    <span class="err">#</span><span class="n">nw</span> <span class="n">maps</span> <span class="n">term</span> <span class="n">to</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">terms</span> <span class="n">it</span> <span class="err">'</span><span class="n">affects</span><span class="err">'</span>
    <span class="err">#</span><span class="p">(</span><span class="n">sum</span> <span class="n">of</span> <span class="n">number</span> <span class="n">of</span> <span class="n">terms</span> <span class="n">in</span> <span class="n">all</span> <span class="n">sentences</span> <span class="n">it</span>
    <span class="err">#</span><span class="n">appears</span> <span class="n">in</span><span class="p">)</span>
    <span class="n">nw</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="err">#</span><span class="n">Co</span><span class="o">-</span><span class="n">occurence</span> <span class="n">values</span> <span class="n">are</span> <span class="n">wrt</span> <span class="n">top</span> <span class="n">terms</span> <span class="n">only</span>
    <span class="n">co_occur</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="err">#</span><span class="n">Initially</span><span class="p">,</span> <span class="n">co</span><span class="o">-</span><span class="n">occurence</span> <span class="n">matrix</span> <span class="n">is</span> <span class="n">empty</span>
    <span class="k">for</span> <span class="n">x</span> <span class="n">in</span> <span class="n">vocabulary</span><span class="o">:</span>
        <span class="n">co_occur</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="n">range</span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="n">topterms</span><span class="p">))]</span>

    <span class="err">#</span><span class="n">Iterate</span> <span class="n">over</span> <span class="n">list</span> <span class="n">of</span> <span class="n">all</span> <span class="n">sentences</span><span class="err">'</span> <span class="n">vocabulary</span> <span class="n">dictionaries</span>
    <span class="err">#</span><span class="n">Build</span> <span class="n">the</span> <span class="n">co</span><span class="o">-</span><span class="n">occurence</span> <span class="n">matrix</span>
    <span class="k">for</span> <span class="n">sentence</span> <span class="n">in</span> <span class="n">sentence_terms</span><span class="o">:</span>
        <span class="n">total_terms</span> <span class="o">=</span> <span class="n">sum</span><span class="p">(</span><span class="n">list</span><span class="p">(</span><span class="n">sentence</span><span class="p">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="err">#</span><span class="n">This</span> <span class="n">list</span> <span class="n">contains</span> <span class="n">the</span> <span class="n">indices</span> <span class="n">of</span> <span class="n">all</span> <span class="n">terms</span> <span class="n">from</span> <span class="n">topterms</span><span class="p">,</span>
        <span class="err">#</span><span class="n">that</span> <span class="n">are</span> <span class="n">present</span> <span class="n">in</span> <span class="n">this</span> <span class="n">sentence</span>
        <span class="n">top_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="err">#</span><span class="n">Populate</span> <span class="n">top_indices</span>
        <span class="n">top_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">topterms</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="n">in</span> <span class="n">sentence</span>
                       <span class="k">if</span> <span class="n">x</span> <span class="n">in</span> <span class="n">topterms</span><span class="p">]</span>
        <span class="err">#</span><span class="n">Update</span> <span class="n">nw</span> <span class="n">dict</span><span class="p">,</span> <span class="n">and</span> <span class="n">co</span><span class="o">-</span><span class="n">occurence</span> <span class="n">matrix</span>
        <span class="k">for</span> <span class="n">term</span> <span class="n">in</span> <span class="n">sentence</span><span class="o">:</span>
            <span class="n">nw</span><span class="p">[</span><span class="n">term</span><span class="p">]</span> <span class="o">=</span> <span class="n">nw</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">total_terms</span>
            <span class="k">for</span> <span class="n">index</span> <span class="n">in</span> <span class="n">top_indices</span><span class="o">:</span>
                <span class="n">co_occur</span><span class="p">[</span><span class="n">term</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">sentence</span><span class="p">[</span><span class="n">term</span><span class="p">]</span> <span class="o">*</span>
                                          <span class="n">sentence</span><span class="p">[</span><span class="n">topterms</span><span class="p">[</span><span class="n">index</span><span class="p">]])</span>

    <span class="err">#</span><span class="n">Pg</span> <span class="n">is</span> <span class="n">just</span> <span class="n">nw</span><span class="p">[</span><span class="n">term</span><span class="p">]</span><span class="o">/</span><span class="n">total</span> <span class="n">vocabulary</span> <span class="n">of</span> <span class="n">text</span>
    <span class="n">Pg</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">sum</span><span class="p">(</span><span class="n">list</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="k">for</span> <span class="n">x</span> <span class="n">in</span> <span class="n">topterms</span><span class="o">:</span>
        <span class="n">Pg</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="kt">float</span><span class="p">(</span><span class="n">nw</span><span class="p">[</span><span class="n">x</span><span class="p">])</span><span class="o">/</span><span class="n">N</span>

    <span class="k">return</span> <span class="n">topterms</span><span class="p">,</span> <span class="n">co_occur</span><span class="p">,</span> <span class="n">Pg</span><span class="p">,</span> <span class="n">nw</span>


<span class="n">def</span> <span class="n">get_top_n_terms</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">,</span> <span class="n">sentence_terms</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span><span class="o">:</span>
    <span class="s">"""</span>
    <span class="n">Returns</span> <span class="n">the</span> <span class="n">top</span> <span class="sc">'n'</span> <span class="n">terms</span> <span class="n">from</span> <span class="n">a</span> <span class="n">block</span> <span class="n">of</span> <span class="n">text</span><span class="p">,</span> <span class="n">in</span> <span class="n">the</span> <span class="n">form</span> <span class="n">of</span> <span class="n">a</span> <span class="n">list</span><span class="p">,</span>
    <span class="n">from</span> <span class="n">most</span> <span class="n">important</span> <span class="n">to</span> <span class="n">least</span><span class="p">.</span>

    <span class="err">'</span><span class="n">vocabulary</span><span class="err">'</span> <span class="n">should</span> <span class="n">be</span> <span class="n">a</span> <span class="n">dict</span> <span class="n">mapping</span> <span class="n">each</span> <span class="n">term</span> <span class="n">to</span> <span class="n">the</span> <span class="n">number</span>
    <span class="n">of</span> <span class="n">its</span> <span class="n">occurences</span> <span class="n">in</span> <span class="n">the</span> <span class="n">entire</span> <span class="n">text</span><span class="p">.</span>
    <span class="err">'</span><span class="n">sentence_terms</span><span class="err">'</span> <span class="n">should</span> <span class="n">be</span> <span class="n">an</span> <span class="n">iterable</span> <span class="n">of</span> <span class="n">dicts</span><span class="p">,</span> <span class="n">each</span> <span class="n">denoting</span> <span class="n">the</span>
    <span class="n">vocabulary</span> <span class="n">of</span> <span class="n">the</span> <span class="n">corresponding</span> <span class="n">sentence</span><span class="p">.</span>
    <span class="s">"""</span>

    <span class="err">#</span><span class="n">First</span> <span class="n">compute</span> <span class="n">the</span> <span class="n">matrices</span>
    <span class="n">topterms</span><span class="p">,</span> <span class="n">co_occur</span><span class="p">,</span> <span class="n">Pg</span><span class="p">,</span> <span class="n">nw</span> <span class="o">=</span> <span class="n">_get_param_matrices</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">,</span>
                                                     <span class="n">sentence_terms</span><span class="p">)</span>

    <span class="err">#</span><span class="n">This</span> <span class="n">dict</span> <span class="n">will</span> <span class="n">map</span> <span class="n">each</span> <span class="n">term</span> <span class="n">to</span> <span class="n">its</span> <span class="n">weightage</span> <span class="n">with</span> <span class="n">respect</span> <span class="n">to</span> <span class="n">the</span>
    <span class="err">#</span><span class="n">document</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">N</span> <span class="o">=</span> <span class="n">sum</span><span class="p">(</span><span class="n">list</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="err">#</span><span class="n">Iterates</span> <span class="n">over</span> <span class="n">all</span> <span class="n">terms</span> <span class="n">in</span> <span class="n">vocabulary</span>
    <span class="k">for</span> <span class="n">term</span> <span class="n">in</span> <span class="n">co_occur</span><span class="o">:</span>
        <span class="n">term</span> <span class="o">=</span> <span class="n">str</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
        <span class="n">org_term</span> <span class="o">=</span> <span class="n">str</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="n">in</span> <span class="n">Pg</span><span class="o">:</span>
            <span class="err">#</span><span class="n">expected_cooccur</span> <span class="n">is</span> <span class="n">the</span> <span class="n">expected</span> <span class="n">cooccurence</span> <span class="n">of</span> <span class="n">term</span> <span class="n">with</span> <span class="n">this</span>
            <span class="err">#</span><span class="n">term</span><span class="p">,</span> <span class="n">based</span> <span class="n">on</span> <span class="n">nw</span> <span class="n">value</span> <span class="n">of</span> <span class="n">this</span> <span class="n">and</span> <span class="n">Pg</span> <span class="n">value</span> <span class="n">of</span> <span class="n">the</span> <span class="n">other</span>
            <span class="n">expected_cooccur</span> <span class="o">=</span> <span class="n">nw</span><span class="p">[</span><span class="n">term</span><span class="p">]</span> <span class="o">*</span> <span class="n">Pg</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
            <span class="err">#</span><span class="n">Result</span> <span class="n">measures</span> <span class="n">the</span> <span class="n">difference</span><span class="p">(</span><span class="n">in</span> <span class="n">no</span> <span class="n">of</span> <span class="n">terms</span><span class="p">)</span> <span class="n">of</span> <span class="n">expected</span>
            <span class="err">#</span><span class="n">cooccurence</span> <span class="n">and</span>  <span class="n">actual</span> <span class="n">cooccurence</span>
            <span class="n">result</span><span class="p">[</span><span class="n">org_term</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">co_occur</span><span class="p">[</span><span class="n">term</span><span class="p">][</span><span class="n">topterms</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span> <span class="o">-</span>
                                 <span class="n">expected_cooccur</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span> <span class="kt">float</span><span class="p">(</span><span class="n">expected_cooccur</span><span class="p">))</span>

    <span class="n">terms</span> <span class="o">=</span> <span class="n">list</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">terms</span><span class="p">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">lambda</span> <span class="n">x</span><span class="o">:</span> <span class="n">result</span><span class="p">[</span><span class="n">x</span><span class="p">],</span>
               <span class="n">reverse</span><span class="o">=</span><span class="n">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">terms</span><span class="p">[</span><span class="o">:</span><span class="n">n</span><span class="p">]</span>
</pre></div>
<p>get_top_n_terms 函数实现了这个功能， 我希望我写的 docstring 和 注释很好地解释了整个过程（结合起那篇论文）。</p>
<p>如果你有时间， 足够耐心， 你可以看到你Word2Vec模型里的整个词库（entire vocabulary）， 并找到你想加入到你的思维导图里的那些项。 这样做大概能得到最好的结果（就是太辛苦）。</p>
<h2 id="_1">第二步： 选定根节点</h2>
<p>根结点是最能表达思维导图中心思想的。 相比起整个词库entire vocabulary， 选中的结点个数小上许多， 所以， 也许最好就是 手工选定根结点的项。</p>
<p>或者， 使用出现频率最高的（has the highest occurrence）。这一步也需要很多尝试（但数学科学能起什么作用吗）</p>
<h2 id="_2">第三步： 生成导图</h2>
<p>这是至关重要的一步， 也是我花了最多时间的。</p>
<p>首先， 我需要定义一个项（term）的 情境向量（contextual vector）</p>
<p>假设， 本导图的根是‘电脑’， 连到另一个项‘硬件’， ‘硬件’再连‘键盘’， 那么， ‘键盘’的Word2Vec向量以 model[keyboard]的方式在Python/Gensim中获得。 定义这个向量为 $ v_{keyboard} $</p>
<p>现在考虑构建过程。</p>
<p>因为你目前已经有了一些东西， 你再想到'键盘‘时， 其实已经处于’电脑‘和’硬件‘的情境（上下文）中。</p>
<p>所以你很难把’键盘‘跟’音乐‘联系起来（最起码不直接相关）。</p>
<p>可见， ’键盘‘的contextual vector情境向量（定义为 $ v^{'}<em computer="computer">{keyboard} $ )一定会将 方向 偏向于 $ v</em> 和 v_{hardware} $ (be biased in its direction towards). ---- 我们要计算 Word2Vec 模型的 cosine 相似度， 当然只跟方向有关。</p>
<p>从直觉上说，  $ v_{hardware} 和 v^{'}<em computer="computer">{keyboard} $ 的影响应该大于 $ v</em> $， 也就是距离越远， 父节点的影响会越小。</p>
<p>为了考虑这个因素， 我再加入了一个 参数 情境递减因子 $ \alpha $ 。 数学表达如下：
$$</p>
<p>v^{'}<em computer="computer">{computer} = v</em> 
$$
$$
v^{'}<em hardware="hardware">{hardware} = (1-\alpha)v</em> + \alpha v^{'}<em keyboard="keyboard">{computer} 
$$
$$
v^{'}</em> = (1-\alpha)v_{keyboard} + \alpha v^{'}_{hardware} </p>
<p>$$</p>
<p>最后， 可以生成实际的导图了， 以下是我使用的算法（我希望行内注释能帮你理解我的工作）</p>
<div class="highlight"><pre><span class="n">from</span> <span class="n">scipy</span><span class="p">.</span><span class="n">spatial</span><span class="p">.</span><span class="n">distance</span> <span class="n">import</span> <span class="n">cosine</span>
<span class="n">from</span> <span class="n">networkx</span> <span class="n">import</span> <span class="n">Graph</span>

<span class="n">def</span> <span class="n">build_mind_map</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">stemmer</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span><span class="o">:</span>
    <span class="s">"""</span>
    <span class="n">Returns</span> <span class="n">the</span> <span class="n">Mind</span><span class="o">-</span><span class="n">Map</span> <span class="n">in</span> <span class="n">the</span> <span class="n">form</span> <span class="n">of</span> <span class="n">a</span> <span class="n">NetworkX</span> <span class="n">Graph</span> <span class="n">instance</span><span class="p">.</span>

    <span class="err">'</span><span class="n">model</span><span class="err">'</span> <span class="n">should</span> <span class="n">be</span> <span class="n">an</span> <span class="n">instance</span> <span class="n">of</span> <span class="n">gensim</span><span class="p">.</span><span class="n">models</span><span class="p">.</span><span class="n">Word2Vec</span>
    <span class="err">'</span><span class="n">nodes</span><span class="err">'</span> <span class="n">should</span> <span class="n">be</span> <span class="n">a</span> <span class="n">list</span> <span class="n">of</span> <span class="n">terms</span><span class="p">,</span> <span class="n">included</span> <span class="n">in</span> <span class="n">the</span> <span class="n">vocabulary</span> <span class="n">of</span>
    <span class="err">'</span><span class="n">model</span><span class="err">'</span><span class="p">.</span>
    <span class="err">'</span><span class="n">root</span><span class="err">'</span> <span class="n">should</span> <span class="n">be</span> <span class="n">the</span> <span class="n">node</span> <span class="n">that</span> <span class="n">is</span> <span class="n">to</span> <span class="n">be</span> <span class="n">used</span> <span class="n">as</span> <span class="n">the</span> <span class="n">root</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Mind</span>
    <span class="n">Map</span> <span class="n">graph</span><span class="p">.</span>
    <span class="err">'</span><span class="n">stemmer</span><span class="err">'</span> <span class="n">should</span> <span class="n">be</span> <span class="n">an</span> <span class="n">instance</span> <span class="n">of</span> <span class="n">StemmingHelper</span><span class="p">.</span>
    <span class="s">"""</span>

    <span class="err">#</span><span class="n">This</span> <span class="n">will</span> <span class="n">be</span> <span class="n">the</span> <span class="n">Mind</span><span class="o">-</span><span class="n">Map</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>

    <span class="err">#</span><span class="n">Ensure</span> <span class="n">that</span> <span class="n">the</span> <span class="n">every</span> <span class="n">node</span> <span class="n">is</span> <span class="n">in</span> <span class="n">the</span> <span class="n">vocabulary</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Word2Vec</span>
    <span class="err">#</span><span class="n">model</span><span class="p">,</span> <span class="n">and</span> <span class="n">that</span> <span class="n">the</span> <span class="n">root</span> <span class="n">itself</span> <span class="n">is</span> <span class="n">included</span> <span class="n">in</span> <span class="n">the</span> <span class="n">given</span> <span class="n">nodes</span>
    <span class="k">for</span> <span class="n">node</span> <span class="n">in</span> <span class="n">nodes</span><span class="o">:</span>
        <span class="k">if</span> <span class="n">node</span> <span class="n">not</span> <span class="n">in</span> <span class="n">model</span><span class="p">.</span><span class="n">vocab</span><span class="o">:</span>
            <span class="n">raise</span> <span class="n">ValueError</span><span class="p">(</span><span class="n">node</span> <span class="o">+</span> <span class="s">" not in model's vocabulary"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">root</span> <span class="n">not</span> <span class="n">in</span> <span class="n">nodes</span><span class="o">:</span>
        <span class="n">raise</span> <span class="n">ValueError</span><span class="p">(</span><span class="s">"root not in nodes"</span><span class="p">)</span>

    <span class="err">##</span><span class="n">Containers</span> <span class="k">for</span> <span class="n">algorithm</span> <span class="n">run</span>
    <span class="err">#</span><span class="n">Initially</span><span class="p">,</span> <span class="n">all</span> <span class="n">nodes</span> <span class="n">are</span> <span class="n">unvisited</span>
    <span class="n">unvisited_nodes</span> <span class="o">=</span> <span class="n">set</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
    <span class="err">#</span><span class="n">Initially</span><span class="p">,</span> <span class="n">no</span> <span class="n">nodes</span> <span class="n">are</span> <span class="n">visited</span>
    <span class="n">visited_nodes</span> <span class="o">=</span> <span class="n">set</span><span class="p">([])</span>
    <span class="err">#</span><span class="n">The</span> <span class="n">following</span> <span class="n">will</span> <span class="n">map</span> <span class="n">visited</span> <span class="n">node</span> <span class="n">to</span> <span class="n">its</span> <span class="n">contextual</span> <span class="n">vector</span>
    <span class="n">visited_node_vectors</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="err">#</span><span class="n">Thw</span> <span class="n">following</span> <span class="n">will</span> <span class="n">map</span> <span class="n">unvisited</span> <span class="n">nodes</span> <span class="n">to</span> <span class="p">(</span><span class="n">closest_distance</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
    <span class="err">#</span><span class="n">parent</span> <span class="n">will</span> <span class="n">obviously</span> <span class="n">be</span> <span class="n">a</span> <span class="n">visited</span> <span class="n">node</span>
    <span class="n">node_distances</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="err">#</span><span class="n">Initialization</span> <span class="n">with</span> <span class="n">respect</span> <span class="n">to</span> <span class="n">root</span>
    <span class="n">current_node</span> <span class="o">=</span> <span class="n">root</span>
    <span class="n">visited_node_vectors</span><span class="p">[</span><span class="n">root</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="n">root</span><span class="p">]</span>
    <span class="n">unvisited_nodes</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="n">visited_nodes</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

    <span class="err">#</span><span class="n">Build</span> <span class="n">the</span> <span class="n">Mind</span><span class="o">-</span><span class="n">Map</span> <span class="n">in</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span> <span class="n">iterations</span>
    <span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="n">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">))</span><span class="o">:</span>
        <span class="err">#</span><span class="n">For</span> <span class="n">every</span> <span class="n">unvisited</span> <span class="n">node</span> <span class="sc">'x'</span>
        <span class="k">for</span> <span class="n">x</span> <span class="n">in</span> <span class="n">unvisited_nodes</span><span class="o">:</span>
            <span class="err">#</span><span class="n">Compute</span> <span class="n">contextual</span> <span class="n">distance</span> <span class="n">between</span> <span class="n">current</span> <span class="n">node</span> <span class="n">and</span> <span class="n">x</span>
            <span class="n">dist_from_current</span> <span class="o">=</span> <span class="n">cosine</span><span class="p">(</span><span class="n">visited_node_vectors</span><span class="p">[</span><span class="n">current_node</span><span class="p">],</span>
                                       <span class="n">model</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
            <span class="err">#</span><span class="n">Get</span> <span class="n">the</span> <span class="n">least</span> <span class="n">contextual</span> <span class="n">distance</span> <span class="n">to</span> <span class="n">x</span> <span class="n">found</span> <span class="n">until</span> <span class="n">now</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="n">node_distances</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="err">''</span><span class="p">))</span>
            <span class="err">#</span><span class="n">If</span> <span class="n">current</span> <span class="n">node</span> <span class="n">provides</span> <span class="n">a</span> <span class="n">shorter</span> <span class="n">path</span> <span class="n">to</span> <span class="n">x</span><span class="p">,</span> <span class="n">update</span> <span class="n">x</span><span class="err">'</span><span class="n">s</span>
            <span class="err">#</span><span class="n">distance</span> <span class="n">and</span> <span class="n">parent</span> <span class="n">information</span>
            <span class="k">if</span> <span class="n">distance</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">dist_from_current</span><span class="o">:</span>
                <span class="n">node_distances</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dist_from_current</span><span class="p">,</span> <span class="n">current_node</span><span class="p">)</span>

        <span class="err">#</span><span class="n">Choose</span> <span class="n">next</span> <span class="err">'</span><span class="n">current</span><span class="err">'</span> <span class="n">as</span> <span class="n">that</span> <span class="n">unvisited</span> <span class="n">node</span><span class="p">,</span> <span class="n">which</span> <span class="n">has</span> <span class="n">the</span>
        <span class="err">#</span><span class="n">lowest</span> <span class="n">contextual</span> <span class="n">distance</span> <span class="n">from</span> <span class="n">any</span> <span class="n">of</span> <span class="n">the</span> <span class="n">visited</span> <span class="n">nodes</span>
        <span class="n">next_node</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">unvisited_nodes</span><span class="p">,</span>
                        <span class="n">key</span><span class="o">=</span><span class="n">lambda</span> <span class="n">x</span><span class="o">:</span> <span class="n">node_distances</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

        <span class="err">##</span><span class="n">Update</span> <span class="n">all</span> <span class="n">containers</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">node_distances</span><span class="p">[</span><span class="n">next_node</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">del</span> <span class="n">node_distances</span><span class="p">[</span><span class="n">next_node</span><span class="p">]</span>
        <span class="n">next_node_vect</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="n">model</span><span class="p">[</span><span class="n">next_node</span><span class="p">]</span> <span class="o">+</span>
                          <span class="n">alpha</span><span class="o">*</span><span class="n">visited_node_vectors</span><span class="p">[</span><span class="n">parent</span><span class="p">])</span>
        <span class="n">visited_node_vectors</span><span class="p">[</span><span class="n">next_node</span><span class="p">]</span> <span class="o">=</span> <span class="n">next_node_vect</span>
        <span class="n">unvisited_nodes</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">next_node</span><span class="p">)</span>
        <span class="n">visited_nodes</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">next_node</span><span class="p">)</span>

        <span class="err">#</span><span class="n">Add</span> <span class="n">the</span> <span class="n">link</span> <span class="n">between</span> <span class="n">newly</span> <span class="n">selected</span> <span class="n">node</span> <span class="n">and</span> <span class="n">its</span> <span class="n">parent</span><span class="p">(</span><span class="n">from</span> <span class="n">the</span>
        <span class="err">#</span><span class="n">visited</span> <span class="n">nodes</span><span class="p">)</span> <span class="n">to</span> <span class="n">the</span> <span class="n">NetworkX</span> <span class="n">Graph</span> <span class="n">instance</span>
        <span class="n">g</span><span class="p">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">stemmer</span><span class="p">.</span><span class="n">original_form</span><span class="p">(</span><span class="n">parent</span><span class="p">).</span><span class="n">capitalize</span><span class="p">(),</span>
                   <span class="n">stemmer</span><span class="p">.</span><span class="n">original_form</span><span class="p">(</span><span class="n">next_node</span><span class="p">).</span><span class="n">capitalize</span><span class="p">())</span>

        <span class="err">#</span><span class="n">The</span> <span class="n">new</span> <span class="n">node</span> <span class="n">becomes</span> <span class="n">the</span> <span class="n">current</span> <span class="n">node</span> <span class="k">for</span> <span class="n">the</span> <span class="n">next</span> <span class="n">iteration</span>
        <span class="n">current_node</span> <span class="o">=</span> <span class="n">next_node</span>

    <span class="k">return</span> <span class="n">g</span>
</pre></div>
<p>备注： 我使用了 NetworkX 的简易图构建架构来完成了思维导图生成的核心任务（使之更易用于可视化）。</p>
<p>要计算 余弦距离， 我使用了 SciPy. </p>
<p>另外注意74和75行， 我使用了上篇博文所写的 StemmingHelper 类， 所以在思维导图中显示的是词干原始形式， 而不是词干。可以将StemmingHelper类直接当做参数 stemmer 传入。 所以， 如果你不需要词干处理， 那就把第4,74,75三行的代码干掉吧。</p>
<p>如果你仔细看过代码， 你会发现， 这看着很像 迪杰斯特拉的单点最短路径， 只是情境不同。</p>
<h2 id="_3">示例输出</h2>
<p><a href="https://codesachin.wordpress.com/2015/10/15/generating-rudimentary-mind-maps-from-word2vec-models/">原文链接</a> 自己看。</p>
<p>看着不错， 和我人工画的也挺像的。</p>
<h2 id="_4">其他</h2>
<p>还有一些可尝试的东西。</p>
<ul>
<li>比如加入 bi-grams 和 trigrams。 我相信能让 Word2Vec 模型更强大， 能对文本做出更好的释义。</li>
<li>导图中仍存在多余项， 但它给出了文本的（最？）短长度（相对其他文本挖掘任务来说）， 这种关键词提取算法（我在上文提到过的论文）似乎相当不错。 这段翻译有点不确认（There are some unnecessary terms in the Mind Maps, but given the short length of the texts (compared to most text mining tasks), the Keyword extraction algorithm in the paper I mentioned before, seems really good.）</li>
<li>此方法可用于头脑风暴， 从你选择的一点出发， 这代码框架会给出建议的可连项， 你再做出选择， 然后又可以得到新的推荐——就有点像思维导图助手。</li>
</ul>
<p>无论怎样， 这都是篇长博文了， 谢谢你坚持着读完全文！（翻译也一样感谢您的阅读）。</p>
	<div class="bdsharebuttonbox bdshare-button-style1-24" data-bd-bind="1444449175032">
		<a href="#" class="bds_more" data-cmd="more"></a>
		<a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
		<a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
		<a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a>
		<a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
		<a href="#" class="bds_copy" data-cmd="copy" title="分享到复制网址"></a>
	</div>

	<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>

	<section>
	<p id="comment-message">this guy is lazy, nothing leave </p>
	<div class="accordion" id="accordion2">
	    <div class="accordion-group">
		<div class="accordion-heading">
		    <a class="accordion-toggle disqus-comment-count" data-toggle="collapse" data-parent="#accordion2"
		        href="/word2vec-2-mindmap.html#disqus_thread">
		        Comments
		    </a>
		</div>
		<div id="disqus_thread" class="accordion-body collapse">
		    <div class="accordion-inner">
		        <div class="comments">
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'sndnyang';
        var disqus_identifier = '/word2vec-2-mindmap.html';
    var disqus_url = '/word2vec-2-mindmap.html';

    (function() {
         var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
         dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
         (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>		        </div>
		    </div>
		</div>
	    </div>
	</div>
	</section>
            <aside>
            <hr/>
            <nav>
            <ul class="articles_timeline">
 
                <li class="previous_article">« <a href="/initate-week1.html" title="Previous: 线性代数启蒙课程第一周">线性代数启蒙课程第一周</a></li>
            </ul>
            </nav>
            </aside>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
 
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2015-10-17T00:00:00">Oct 17, 2015</time>
 
            <h4>Last Updated</h4>
            <div class="last_updated">2015-10-17 00:00:00</div>
            <h4>Category</h4>
            <a class="category-link" href="/categories.html#翻译-ref">翻译</a> 
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article"> 
                <li><a href="/tags.html#nlp-ref">nlp
                    <span>1</span>
</a></li>
                <li><a href="/tags.html#word2vec-ref">word2vec
                    <span>1</span>
</a></li>
            </ul>
            <h4>Stay in Touch</h4>
	<a href="http://weibo.com/u/2405149384" title="My Weibo Profile" class="sidebar-social-links" target="_blank">
	    <i class="icon icon-twitter sidebar-social-links"></i></a>
	<a href="http://github.com/sndnyang" title="My Github Profile" class="sidebar-social-links" target="_blank">
	    <i class="icon icon-github sidebar-social-links"></i></a>
	<a href="http://blog.csdn.net/sndnyangd" title="My CSDN Profile" class="sidebar-social-links" target="_blank">
	    <i class="icon icon-facebook sidebar-social-links"></i></a>

        </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
        <div id="top" data-toggle="tooltip" data-placement="left" title="回到顶部">
        <a href="javascript:;">
        <div class="arrow"></div>
        <div class="stick"></div>
      </a>
    </div>
    </div>
    
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
        <script>
	
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

<script type="text/javascript">
    var disqus_shortname = 'sndnyang';

    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
        <script  language="javascript" type="text/javascript">
            function uncollapse() {
                var hash_str = window.location.hash;
                if (window.location.hash.match(/^#comment-\d+$/))
                {
                    var hash_str = '#disqus_thread';
                }
                $(hash_str).collapse({
                    toggle: true
                    })
            }
        </script>

        <script type="text/javascript" language="JavaScript">
            uncollapse(); 
        </script>

    </body>
</html>